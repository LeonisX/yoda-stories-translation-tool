Yoda Stories Version Comparison
===============================

We know and have identified the following versions of the game:

* Star Wars - Yoda Stories (14.02.1997) (Eng) (v1.0)
* Star Wars - Yoda Stories (14.02.1997) (Eng) (v1.0) (Patch v6)
* Star Wars - Yoda Stories (18.02.1997) (Eng) (v1.1)
* Star Wars - Yoda Stories (18.02.1997) (Eng) (Demo)
* **Star Wars - Yoda Stories (10.08.1998) (Eng) (v1.2) (Patch v6)**
* Star Wars - Yoda Stories (22.05.1997) (Spa)
* Star Wars - Yoda Stories (25.06.1997) (Ger)
* Star Wars - Yoda Stories (13.12.2001) (T-Spa_Selva Translators)
* Star Wars - Yoda Stories (12.11.2006) (T-Rus_PRO)
* TODO My translation

They are identified by the checksums of the yodesk.exe and yodesk.dta files.

Даты релизов не соответствуют датам начала продаж игр. Это даты последнего изменения файлов игры перед её публикацией.

Обратите внимание, что версия (v1.0) (Patch v6) в продажу не поступала. Это результат использования патча с исправлениями
на первой версии игры. Она, кстати, а так же комбинация с патчем, являются самыми распространёнными версиями.

DTA файл из версии игры 1.2 полностью совпадает с DTA файлом из версии игры 1.0 с наложенным патчем исправлений.

Версия игры 1.1 является самой редкой англоязычной версией, но именно на её основе была собрана демо-версия, которая, благодаря своей бесплатности, очень широко распространена.

Selva Translators изменили только экран About в Испанской версии игры.

Испанская и Германская версии игры имеют все критические исправления из Patch 6, а если исправить ещё 3 байта, то в квестовых локациях будет играть верная мелодия.

Доподлинно известно существование ещё двух локализованных версий игры для Франции и Италии.
Если они у вас сохранились, то, пожалуйста, пришлите нам их для изучения. E-mail: tv-games@mail.ru

Поскольку сравнивать изменения в EXE файлах достаточно трудоёмко, мы сконцентрируем своё внимание на различиях DTA файлов.

1.0 vs 1.1
----------

Несколько различий в зонах.

**Zone 151**: Actions 4, 5

Было:

* Скрывается тайл [11; 1; 2] (x, y, z координаты)
* Скрывается тайл [11; 2; 1]

Стало:

* Показывается тайл 1787 [11; 1; 2] (x, y, z координаты)
* Показывается тайл 1787 [11; 2; 2]
* Скрывается тайл [11; 2; 1]

![](images/tiles/tauntaun.png)

Это история со случайным появлением Tauntaun в правой части экрана.
Приятный секретик, в снаряжении того двуногого ездового животного можно кое-что найти.

![](images/code/z151-a4-5.png)

Изменены сугробы в верхней части карты (розовые участки).

![](images/zones/z151-diff.png)

**Zone 176**: new Monster 61 [7; 6] loot: 65535; dropsLoot: 0

![](images/zones/z176.png)

Добавлен робот серии R2, не помню, падает из него что-то или нет.
Куда интереснее следующее исправление:

`izx4:_unnamed2: 1 -> 0`

Пока можно только догадываться что здесь поменяли разработчики.

**Zone 203**: new Monster 61 [1; 3] loot: 65535; dropsLoot: 0

![](images/zones/z203.png)

Ещё один робот R2 на заснеженной локации.

Так же в двух местах тайл 678 был заменён на тайл 680, но фактически эти файлы идентичны.

![](images/tiles/0678.png) ![](images/tiles/0680.png)

**Zone 430**: Action 4: исправление в достаточно длинном действии, конкретно, в диалоге NPC:

![](images/zones/z430.png)

Неверная координата Y диалога.

![](images/code/z430-a4.png)

**Zone 535**: New Action 50 conditions: 1; instructions: 3

![](images/zones/z535.png)

```
Action 50
if
    placed-item-is: 5 5 1 780 809
then
    play-sound: 0 0 19968 184 0 ""
    remove-item: 809 0 3956 184 0 ""
    speak-npc: 5 5 0 0 0 "Han! Good to see him safe. Friends you cannot forget, mmm?"
```

![](images/tiles/0780.png) ![](images/tiles/0809.png)

Код достаточно легко понять. Йода (тайл 780) находится по координатам [5, 5, 1].
Если ему отдать Хана (тайл 809), то из инвентаря этот тайл извлекается,
и Йода произносит свою речь.


1.1 vs 1.2
----------

Официально исправлены следующие зоны: `72, 236, 407, 473, 474, 572`.
Фактически исправлены следующие зоны: `72, 236, 266, 267, 271, 407, 472, 572`.

Различия найдены в: Tiles, Zones, Characters.

**Tile 1543**:

Исправление достаточно забавное, оцените сами, что было, как стало, и разница:

![](images/tiles/1543-11.png) ![](images/tiles/1543-12.png) ![](images/tiles/1543-diff.png)

Пасхалочка?

**Characters**: изменения в неиспользуемой части имени персонажа. У этого значения фиксированная длина 16, то есть,
максимальная длина имени составляет 15, и последний байт равен 0x00.
Если длина имени персонажа меньше 15, то выглядывают неиспользуемые данные.
Они упорядочены, и вероятно являются какой-то перезаписанной структурой данных. Примеры:

```
1F440002000000 804CBE00 -> 1F440002000000 0072BE00
1F440002000000 304DBE00 -> 1F440002000000 B072BE00
```

В демо-версии игры, кстати, адрес заметно меньше, например: `207ABD00`.

Единственное что можно добавить - расстояния между этими смещениями составляют 0xB0 (176).
При том, что одна запись Characters имеет длину в 84 байта.

![](images/code/characters-diff.png)

**Zone 72**: Action 14: + 1 instruction

![](images/zones/z072.png)

NPC бросает квестовый предмет в [10, 12].

![](images/code/z72-a14.png)

**Zone 236**: Была проблема с хотспотом на транспорте, видимо, не получалось взять предмет.

![](images/zones/z236.png)

![](images/code/z236-hp.png)

**Zone 266**: New Action 1:

![](images/zones/z266.png)

Когда зона не инициализирована, играет музыкальная тема Mystery. Эту, и две последующие локации
Йода показывает Люку через каждые 5 побед. После выполнения квеста юный джедай становится сильнее.

```
if
    zone-not-initialised: 0 0 0 0 0
then
    play-sound: 60 0 6368 128 0 ""
```

Action 14 (15):

Запустить музыкальную тему Flourish.

![](images/code/z266-14.png)

**Zone 267**: New Action 0:

![](images/zones/z267.png)

Когда зона не инициализирована, играет музыкальная тема Mystery.

```
if
    zone-not-initialised: 0 0 0 0 0
then
    play-sound: 60 0 6368 128 0 ""
```

Action 9 (10): 

Исправлен звук здесь: Hello, Luke. Yoda has trained you well. May the FORCE be with you...!

Запустить музыкальную тему Flourish.

![](images/code/z267-9.png)
	
**Zone 271**: New Action 0:

![](images/zones/z271.png)

Снова исправление звуков.

```
if
    zone-not-initialised: 0 0 0 0 0
then
    play-sound: 60 0 6368 128 0 ""
```

Action 1 (2): 

play-sound: 58

A dianoga heart... eeuw! Sometimes I wonder about old Yoda!"

![](images/code/z271-1.png)

**Zone 407**: Небольшие ошибки в графике

![](images/zones/z407.png)

Здесь работает логика расстановки льда, пока зона не инициализирована.

![](images/code/z407-6.png)

![](images/code/z407-7.png)

Три перестановки тайлов в верхней части карты:

* [1; 3]: [678, 65535, 1248] -> [678, 681, 65535]
* [1; 4]: [678, 65535, 1248] -> [678, 681, 65535]
* [2; 5]: [678, 681, 65535] -> [2; 5]: [678, 65535, 1248]

Визуально они не видны, так как эти тайлы идентичны. 
Важно другое - появилось 2 препятствия в невидимой части карты, и одно было убрано.

**Zone 472**: a lot of fixes

![](images/zones/z472.png)

Это сложная карта и в её работу закралось приличное количество ошибок и недоработок.
Есть смелое предположение, что не все ошибки были найдены до сих пор.
Стоит написать интерпретатор скриптов, чтобы убедиться в этом наверняка.

Action 6 теперь имеет номер 3.

Actions 3, 4: в зависимости от определённых условий на карте размещается тайл с трещиной: ![](images/tiles/0008.png)

![](images/code/z472-3-4.png)

A lot of new actions:

```
Action 6
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 1 16 4 0 0
then
    set-shared-counter: 1 0 25938 25697 121 ""

Action 7
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 2 16 4 0 0
then
    set-shared-counter: 2 0 25938 25697 121 ""

Action 8
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 3 16 4 0 0
then
    set-shared-counter: 3 0 25938 25697 121 ""

Action 9
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 4 16 4 0 0
then
    set-shared-counter: 4 0 25938 25697 121 ""

Action 10
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 5 16 4 0 0
then
    set-shared-counter: 5 0 25938 25697 121 ""

Action 11
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 6 16 4 0 0
then
    set-shared-counter: 6 0 25938 25697 121 ""

Action 12
if
    zone-entered: 0 0 0 -30348 322
    is-variable: 7 16 4 0 0
then
    set-shared-counter: 7 0 25938 25697 121 ""

Action 13
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 1 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 1 7608 ""

Action 14
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 2 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 2 7608 ""

Action 15
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 3 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 3 7608 ""

Action 16
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 4 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 4 7608 ""

Action 17
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 5 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 5 7608 ""

Action 18
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 6 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 6 7608 ""

Action 19
if
    zone-entered: 0 6 0 25939 18292
    shared-counter-is: 7 0 0 0 0
    is-variable: 0 16 4 0 0
then
    set-variable: 16 4 0 7 7608 ""
```

**Zone 572**: Fixed two hotspots

![](images/zones/z572.png)

Эта лесистая местность так же стала источником ошибок, когда не удавалось заполучить квестовый предмет.

![](images/code/z572-hp.png)


1.1 English vs Spanish version
----------------------

Испанская версия Yoda Stories находится между 1.1 и 1.2. В частности, здесь ещё не добавлены мелодии для зон: 266, 267, 271.

На самом деле, достаточно изменить всего 3 байта, и эта игра получит все исправления, характерные для Patch 6, ведь код для проигрывания мелодии уже есть на месте, но он запускает мелодию под номером 0.

* Startup screen
* Tiles
* Zones
* Puzzles
* Characters
* Tile names
* Tile genders

**Startup screen**:

Розовые участки показывают, где были звёзды.

![](images/zones/z000-diff.png)

Надо понимать, что аналогичное изменение есть и в зоне 0.

**Tiles**:

Чтобы уместить весь текст, количество тайлов было увеличено с 2123 до 2126.

* Изменены: 2090-2108
* Новые: 2123-2125

Эти тайлы используются в зонах 76-77.

**Zone 72**: исправление идентично версии 1.2

**Zones 76-77**:

![](images/zones/076sp.png) ![](images/zones/077sp.png)

**Zone 236**: исправление идентично версии 1.2

**Zone 407**: исправление идентично версии 1.2

**Zone 472**: исправление идентично версии 1.2*

На самом деле, если сравнивать добавленные скрипты, то можно увидеть очень много
изменений в неиспользуемых аргументах, по сравнению с версией 1.2. Скорее всего это ничего не значащие данные.

**Zone 572**: исправление идентично версии 1.2

**Puzzles**: 100% различие в тесте, но это было ожидаемо.

**Characters**: различия только в неиспользуемых данных.

**Tile names**: 100% различие в тесте, но это было ожидаемо.
 
**Tile genders**: это новая структура данных, типичная для языков, в которых артикль используется для изменения рода.


Spanish version vs German version
----------------------

Несмотря на то, что Германская версия близка к Испанской, у неё есть одно
важное отличие - загрузочный экран и Зона 0 не были испорчены. Вероятно, это может указывать на то, что над Испанским переводом
работала другая команда, или, Германскую версию собирали раньше.

Если не обращать внимание на языковые различия, то в остальном эти версии идентичны.

**Tiles**:

В этой версии тайлов на 1 больше, чем в английской.

* Изменены: 2091-2095, 2097-2107
* Новый: 2123

Эти тайлы используются в зонах 76-77.

**Zones 76-77**:

![](images/zones/076de.png) ![](images/zones/077de.png)

**Zone 472**: различия среди неиспользуемых аргументов инструкций.


T-Rus
-----

Основана на версии 1.2 (она же Patch 6)

Два несущественных изменения в неиспользуемых аргументах действий в зонах 562 и 578. Вероятно, внесены вручную.

Графика не переведена, а имена тайлов переведены лишь частично.